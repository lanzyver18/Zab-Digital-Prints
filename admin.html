<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zab Admin | Professional Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ffb7c5; --dark-pink: #d48192; --bg: #fff5f6; --text: #2d3436; }
        
        body { font-family: 'Poppins', sans-serif; margin: 0; background: #f8f9fa; color: var(--text); display: flex; min-height: 100vh; }
        
        /* Sidebar Nav */
        .sidebar { width: 280px; background: white; border-right: 1px solid #edf2f7; display: flex; flex-direction: column; position: sticky; top: 0; height: 100vh; }
        .sidebar-header { padding: 30px; border-bottom: 1px solid #f1f1f1; text-align: center; }
        .sidebar-menu { padding: 20px; flex-grow: 1; }
        .menu-item { padding: 12px 15px; border-radius: 10px; color: #636e72; cursor: pointer; margin-bottom: 5px; transition: 0.3s; font-weight: 500; }
        .menu-item:hover, .menu-item.active { background: var(--bg); color: var(--dark-pink); }

        /* Main Workspace */
        .workspace { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #f1f1f1; }
        .stat-card h5 { margin: 0; color: #b2bec3; font-size: 0.8rem; text-transform: uppercase; }
        .stat-card div { font-size: 1.8rem; font-weight: bold; color: var(--dark-pink); }

        /* Split Layout */
        .content-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; }
        
        .form-container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); height: fit-content; position: sticky; top: 30px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #eee; border-radius: 10px; background: #fcfcfc; font-family: inherit; transition: 0.3s; }
        input:focus { border-color: var(--pink); outline: none; background: white; }
        
        button { width: 100%; padding: 14px; background: var(--dark-pink); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 15px; transition: 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212, 129, 146, 0.3); }

        /* Inventory List */
        .inventory-list { background: white; padding: 20px; border-radius: 20px; border: 1px solid #f1f1f1; }
        .product-row { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f9f9f9; transition: 0.2s; }
        .product-row:hover { background: #fafafa; }
        .product-row img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; margin-right: 20px; border: 1px solid #eee; }
        .info { flex-grow: 1; }
        .info b { display: block; font-size: 1rem; }
        .info span { font-size: 0.8rem; color: #999; }
        
        .action-btns { display: flex; gap: 8px; }
        .btn-edit { background: #e3f2fd; color: #1976d2; padding: 8px 15px; border-radius: 8px; font-size: 0.75rem; border: none; cursor: pointer; }
        .btn-del { background: #ffebee; color: #d32f2f; padding: 8px 15px; border-radius: 8px; font-size: 0.75rem; border: none; cursor: pointer; }

        /* Responsive */
        @media (max-width: 1100px) { .content-grid { grid-template-columns: 1fr; } .sidebar { display: none; } }
        #login-gate { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login-gate">
    <div style="width: 350px; text-align: center;">
        <h2 style="color: var(--dark-pink);">Zab Admin</h2>
        <input type="password" id="entryPass" placeholder="Enter Admin Password">
        <button onclick="login()">Enter Workspace</button>
    </div>
</div>

<aside class="sidebar">
    <div class="sidebar-header">
        <b style="color: var(--dark-pink); font-size: 1.2rem;">ZAB PRINTS</b>
    </div>
    <div class="sidebar-menu">
        <div class="menu-item active">Dashboard</div>
        <div class="menu-item">Orders (Coming Soon)</div>
        <div class="menu-item" onclick="location.reload()">Logout</div>
    </div>
</aside>

<main class="workspace">
    <div class="stats-bar">
        <div class="stat-card">
            <h5>Total Products</h5>
            <div id="count-all">0</div>
        </div>
        <div class="stat-card">
            <h5>Available Items</h5>
            <div id="count-avail">0</div>
        </div>
        <div class="stat-card">
            <h5>Sold Out</h5>
            <div id="count-sold" style="color: #fab1a0;">0</div>
        </div>
    </div>

    <div class="content-grid">
        <div class="form-container">
            <h3 id="formHeader" style="margin-top:0;">Add New Product</h3>
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price (PHP)">
            
            <label style="font-size:0.7rem; color:#aaa; margin-left:5px;">Category</label>
            <select id="pCat">
                <option value="Mugs">Mugs</option>
                <option value="Keychains">Keychains</option>
                <option value="Others">Others</option>
            </select>

            <label style="font-size:0.7rem; color:#aaa; margin-left:5px;">Visibility</label>
            <select id="pStatus">
                <option value="Available">Available</option>
                <option value="Sold Out">Sold Out</option>
            </select>

            <input type="text" id="pImg" placeholder="Direct Image URL" oninput="showPrev(this.value)">
            <img id="prev" style="width:100%; height:180px; object-fit:cover; display:none; border-radius:15px; margin-top:15px;">
            
            <button id="saveBtn">Save to Catalog</button>
        </div>

        <div class="inventory-list">
            <h3 style="margin-top:0;">Inventory Management</h3>
            <div id="admin-list">Loading items...</div>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyApoIe2nemnhB8unIDzoD5mnMSIMQv5pb0",
        authDomain: "zab-digital-prints.firebaseapp.com",
        projectId: "zab-digital-prints",
        storageBucket: "zab-digital-prints.firebasestorage.app",
        messagingSenderId: "1050157785592",
        appId: "1:1050157785592:web:e6a3c8f10a9d28aa87b60d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let editID = null;

    window.login = () => {
        if(document.getElementById('entryPass').value === "zab123") {
            document.getElementById('login-gate').style.display = "none";
            loadData();
        } else { alert("Incorrect password"); }
    };

    window.showPrev = (url) => {
        const p = document.getElementById('prev');
        p.src = url; p.style.display = url ? 'block' : 'none';
    };

    document.getElementById('saveBtn').onclick = async () => {
        const data = {
            name: document.getElementById('pName').value,
            price: document.getElementById('pPrice').value,
            category: document.getElementById('pCat').value,
            status: document.getElementById('pStatus').value,
            imgUrl: document.getElementById('pImg').value
        };

        if(editID) {
            await updateDoc(doc(db, "products", editID), data);
            alert("Updated!");
        } else {
            await addDoc(collection(db, "products"), { ...data, createdAt: Date.now() });
            alert("Added!");
        }
        location.reload();
    };

    function loadData() {
        onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('admin-list');
            list.innerHTML = "";
            let all = 0, avail = 0, sold = 0;

            snap.forEach(d => {
                const item = d.data();
                all++;
                if(item.status === 'Available') avail++; else sold++;

                const row = document.createElement('div');
                row.className = "product-row";
                row.innerHTML = `
                    <img src="${item.imgUrl}">
                    <div class="info">
                        <b>${item.name}</b>
                        <span>₱${item.price} • ${item.category}</span>
                    </div>
                    <div class="action-btns">
                        <button class="btn-edit" onclick="editProduct('${d.id}', '${item.name}', '${item.price}', '${item.category}', '${item.status}', '${item.imgUrl}')">Edit</button>
                        <button class="btn-del" onclick="deleteItem('${d.id}')">Delete</button>
                    </div>
                `;
                list.appendChild(row);
            });

            document.getElementById('count-all').innerText = all;
            document.getElementById('count-avail').innerText = avail;
            document.getElementById('count-sold').innerText = sold;
        });
    }

    window.editProduct = (id, n, p, c, s, i) => {
        editID = id;
        document.getElementById('pName').value = n;
        document.getElementById('pPrice').value = p;
        document.getElementById('pCat').value = c;
        document.getElementById('pStatus').value = s;
        document.getElementById('pImg').value = i;
        document.getElementById('saveBtn').innerText = "Update Product";
        document.getElementById('formHeader').innerText = "Edit Mode";
        showPrev(i);
        window.scrollTo(0,0);
    };

    window.deleteItem = async (id) => { if(confirm("Permanently delete?")) await deleteDoc(doc(db, "products", id)); };
</script>
</body>
</html>
