<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Zab Digital</title>
    <style>
        :root { --pink: #ffb7c5; --dark-pink: #d48192; --bg: #fff5f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        .admin-layout { 
            display: flex; 
            flex-direction: row; 
            min-height: 100vh; 
        }

        /* Form Sidebar on Desktop, Top on Mobile */
        .form-side { 
            width: 400px; 
            background: white; 
            padding: 30px; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.05); 
            position: sticky; 
            top: 0; 
            height: 100vh;
            overflow-y: auto;
        }

        /* Inventory Side stretches to fill browser */
        .list-side { 
            flex-grow: 1; 
            padding: 40px; 
        }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--dark-pink); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        .item-card { 
            background: white; 
            display: flex; 
            align-items: center; 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 15px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .item-card img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; margin-right: 20px; }
        
        /* Mobile View Switch */
        @media (max-width: 900px) {
            .admin-layout { flex-direction: column; }
            .form-side { width: 100%; height: auto; position: static; padding: 20px; box-sizing: border-box; }
            .list-side { padding: 20px; }
        }

        #login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 2000; 
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div style="background:white; padding:40px; border-radius:20px; width:300px; text-align:center;">
        <h3>Zab Admin</h3>
        <input type="password" id="passCode" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>
</div>

<div class="admin-layout" id="mainDashboard" style="display:none;">
    <aside class="form-side">
        <h2 id="formTitle">Add Product</h2>
        <input type="text" id="pName" placeholder="Name">
        <input type="number" id="pPrice" placeholder="Price">
        <select id="pCat">
            <option value="Mugs">Mugs</option>
            <option value="Keychains">Keychains</option>
            <option value="Others">Others</option>
        </select>
        <input type="text" id="pImg" placeholder="Image URL" oninput="document.getElementById('prev').src=this.value; document.getElementById('prev').style.display='block'">
        <img id="prev" style="width:100%; height:150px; object-fit:cover; display:none; border-radius:8px; margin: 10px 0;">
        <button id="saveBtn" onclick="saveData()">Save Product</button>
        <button onclick="location.reload()" style="background:#888; margin-top:10px;">Logout</button>
    </aside>

    <main class="list-side">
        <h2>Live Inventory</h2>
        <div id="admin-list">Loading...</div>
    </main>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyApoIe2nemnhB8unIDzoD5mnMSIMQv5pb0",
        authDomain: "zab-digital-prints.firebaseapp.com",
        projectId: "zab-digital-prints",
        storageBucket: "zab-digital-prints.firebasestorage.app",
        messagingSenderId: "1050157785592",
        appId: "1:1050157785592:web:e6a3c8f10a9d28aa87b60d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let editID = null;

    window.login = () => {
        if(document.getElementById('passCode').value === "zab123") {
            document.getElementById('login-overlay').style.display = "none";
            document.getElementById('mainDashboard').style.display = "flex";
            loadList();
        } else { alert("Wrong password"); }
    };

    window.saveData = async () => {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const category = document.getElementById('pCat').value;
        const imgUrl = document.getElementById('pImg').value;

        if(editID) {
            await updateDoc(doc(db, "products", editID), { name, price, category, imgUrl });
            alert("Updated!");
        } else {
            await addDoc(collection(db, "products"), { name, price, category, imgUrl, createdAt: Date.now() });
            alert("Added!");
        }
        location.reload();
    };

    function loadList() {
        onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('admin-list');
            list.innerHTML = "";
            snap.forEach(d => {
                const item = d.data();
                const div = document.createElement('div');
                div.className = "item-card";
                div.innerHTML = `
                    <img src="${item.imgUrl}">
                    <div style="flex-grow:1">
                        <b>${item.name}</b><br>â‚±${item.price} - ${item.category}
                    </div>
                    <button onclick="editItem('${d.id}', '${item.name}', '${item.price}', '${item.category}', '${item.imgUrl}')" style="width:auto; background:#5cb85c; margin-right:5px;">Edit</button>
                    <button onclick="deleteItem('${d.id}')" style="width:auto; background:#ff4d4d;">Del</button>
                `;
                list.appendChild(div);
            });
        });
    }

    window.editItem = (id, n, p, c, i) => {
        editID = id;
        document.getElementById('pName').value = n;
        document.getElementById('pPrice').value = p;
        document.getElementById('pCat').value = c;
        document.getElementById('pImg').value = i;
        document.getElementById('formTitle').innerText = "Edit Product";
        document.getElementById('saveBtn').innerText = "Update Product";
        window.scrollTo(0,0);
    };

    window.deleteItem = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "products", id)); };
</script>
</body>
</html>
