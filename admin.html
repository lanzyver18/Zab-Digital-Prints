<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zab Admin | Control Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ffb7c5; --dark-pink: #d48192; --bg: #fff5f6; --text: #2d3436; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: #f8f9fa; display: flex; }
        .sidebar { width: 240px; background: #fff; height: 100vh; border-right: 1px solid #eee; position: sticky; top: 0; padding: 20px; }
        .workspace { flex: 1; padding: 40px; }
        .card { background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #eee; border-radius: 10px; }
        .btn { background: var(--dark-pink); color: #fff; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; }
        .product-row { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; gap: 15px; }
        .tag { background: var(--bg); padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; margin: 4px; border: 1px solid var(--pink); display: inline-block; }
        .order-card { border: 1.5px solid #eee; padding: 20px; border-radius: 15px; background: #fff; margin-bottom: 15px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; cursor: pointer; }
        .paid { background: #e6fffa; color: #234e52; }
        .unpaid { background: #fff5f5; color: #822727; }
    </style>
</head>
<body>

<aside class="sidebar">
    <h2>ZAB ADMIN</h2>
    <div onclick="switchTab('inventory')" style="cursor:pointer; padding:10px;">Inventory</div>
    <div onclick="switchTab('orders')" style="cursor:pointer; padding:10px;">Orders</div>
    <div onclick="location.reload()" style="cursor:pointer; padding:10px; color:red;">Logout</div>
</aside>

<main class="workspace">
    <div id="inventory" class="tab-content active">
        <div class="card">
            <h3 id="formHeader">Add Product</h3>
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Base Price">
            <input type="text" id="pMoq" placeholder="MOQ">
            <textarea id="pDesc" placeholder="Description"></textarea>
            
            <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin:10px 0;">
                <b>Variants</b>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="optName" placeholder="Size/Type" style="margin:0;">
                    <input type="number" id="optPrice" placeholder="Price" style="margin:0; width:100px;">
                    <button onclick="addOption()" style="padding:10px; background:#74b9ff; color:white; border:none; border-radius:10px;">Add</button>
                </div>
                <div id="opt-tags" style="margin-top:10px;"></div>
            </div>

            <select id="pCat"></select>
            <input type="text" id="pImg" placeholder="Image URL">
            <button class="btn" onclick="saveProduct()">Save Product</button>
        </div>

        <div class="card">
            <h3>All Products</h3>
            <div id="inv-list"></div>
        </div>
    </div>

    <div id="orders" class="tab-content">
        <div class="card">
            <h3>Recent Orders</h3>
            <div id="order-list"></div>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const db = getFirestore(initializeApp({ apiKey: "AIzaSyApoIe2nemnhB8unIDzoD5mnMSIMQv5pb0", projectId: "zab-digital-prints" }));

    let editID = null, items = [], opts = [];

    onSnapshot(collection(db, "categories"), snap => {
        document.getElementById('pCat').innerHTML = snap.docs.map(d => `<option value="${d.id}">${d.id}</option>`).join('');
    });

    onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), snap => {
        items = snap.docs.map(d => ({id: d.id, ...d.data()}));
        renderInv();
    });

    onSnapshot(query(collection(db, "orders"), orderBy("createdAt", "desc")), snap => {
        document.getElementById('order-list').innerHTML = snap.docs.map(d => {
            const o = d.data();
            return `
            <div class="order-card">
                <b>${o.customerName}</b> <span class="badge ${o.paid ? 'paid' : 'unpaid'}" onclick="togglePaid('${d.id}', ${o.paid})">${o.paid ? 'PAID' : 'UNPAID'}</span>
                <div style="font-size:0.8rem; margin:10px 0;">üìß ${o.email} | üìû ${o.phone}<br>üìç ${o.address}</div>
                <div style="font-size:0.85rem;">${o.items.map(i => `‚Ä¢ ${i.name} - ‚Ç±${i.price}`).join('<br>')}</div>
                <div style="margin-top:10px;"><b>Total: ${o.total}</b></div>
                <button onclick="delOrder('${d.id}')" style="background:red; color:white; border:none; padding:5px; margin-top:10px; cursor:pointer; border-radius:5px;">Clear</button>
            </div>`;
        }).join('');
    });

    window.addOption = () => {
        const n = document.getElementById('optName').value, p = document.getElementById('optPrice').value;
        if(n && p) { opts.push({name: n, price: Number(p)}); renderOpts(); }
        document.getElementById('optName').value = ""; document.getElementById('optPrice').value = "";
    };

    function renderOpts() {
        document.getElementById('opt-tags').innerHTML = opts.map((o,i) => `<span class="tag">${o.name} (‚Ç±${o.price}) <b onclick="window.removeOpt(${i})" style="cursor:pointer;">&times;</b></span>`).join('');
    }
    window.removeOpt = i => { opts.splice(i, 1); renderOpts(); };

    function renderInv() {
        document.getElementById('inv-list').innerHTML = items.map(i => `
            <div class="product-row">
                <img src="${i.imgUrl || 'IMG_1218.jpeg'}" style="width:40px;height:40px;object-fit:cover;">
                <div style="flex:1"><b>${i.name}</b></div>
                <button onclick="window.editItem('${i.id}')">Edit</button>
                <button onclick="window.delItem('${i.id}')">Del</button>
            </div>
        `).join('');
    }

    window.editItem = id => {
        const i = items.find(x => x.id === id);
        editID = id;
        document.getElementById('pName').value = i.name;
        document.getElementById('pPrice').value = i.price;
        document.getElementById('pMoq').value = i.moq || "";
        document.getElementById('pDesc').value = i.description || "";
        document.getElementById('pCat').value = i.category;
        document.getElementById('pImg').value = i.imgUrl || "";
        opts = i.options || [];
        renderOpts();
        document.getElementById('formHeader').innerText = "Editing: " + i.name;
    };

    window.saveProduct = async () => {
        const data = { name: document.getElementById('pName').value, price: Number(document.getElementById('pPrice').value), moq: document.getElementById('pMoq').value, description: document.getElementById('pDesc').value, options: opts, category: document.getElementById('pCat').value, imgUrl: document.getElementById('pImg').value, createdAt: Date.now() };
        editID ? await updateDoc(doc(db, "products", editID), data) : await addDoc(collection(db, "products"), data);
        location.reload();
    };

    window.delItem = id => confirm("Delete?") && deleteDoc(doc(db, "products", id));
    window.delOrder = id => confirm("Clear?") && deleteDoc(doc(db, "orders", id));
    window.togglePaid = (id, s) => updateDoc(doc(db, "orders", id), { paid: !s });
    window.switchTab = id => {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    };
</script>
</body>
</html>
