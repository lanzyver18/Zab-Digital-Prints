<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zab Admin Dashboard</title>
    <style>
        :root { --pink: #ffb7c5; --dark-pink: #d48192; --bg: #fff5f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: row; min-height: 100vh; }
        
        .sidebar { width: 380px; background: white; padding: 30px; border-right: 1px solid #eee; position: sticky; top: 0; height: 100vh; overflow-y: auto; box-sizing: border-box; }
        .main-content { flex-grow: 1; padding: 40px; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; background: var(--bg); }
        button { width: 100%; padding: 12px; background: var(--dark-pink); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        .inventory-card { background: white; padding: 15px; border-radius: 15px; display: flex; align-items: center; margin-bottom: 15px; gap: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .inventory-card img { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; border: 2px solid var(--pink); }
        
        @media (max-width: 900px) { body { flex-direction: column; } .sidebar { width: 100%; height: auto; position: static; } }
        #login-gate { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login-gate">
    <div style="background:white; padding:40px; border-radius:30px; width:320px; text-align:center;">
        <h2 style="color:var(--dark-pink)">Zab Admin</h2>
        <input type="password" id="entryPass" placeholder="Access Password">
        <button onclick="login()">Enter Dashboard</button>
    </div>
</div>

<div class="sidebar">
    <h2 id="formHeader" style="color:var(--dark-pink)">Manage Product</h2>
    <input type="text" id="pName" placeholder="Product Name">
    <input type="number" id="pPrice" placeholder="Price (PHP)">
    
    <label style="font-size:0.8rem; margin-top:10px; display:block;">Category</label>
    <select id="pCat">
        <option value="Mugs">Mugs</option>
        <option value="Keychains">Keychains</option>
        <option value="Others">Others</option>
    </select>

    <label style="font-size:0.8rem; margin-top:10px; display:block;">Availability</label>
    <select id="pStatus">
        <option value="Available">Available</option>
        <option value="Sold Out">Sold Out</option>
    </select>

    <input type="text" id="pImg" placeholder="Image URL (Direct Link)" oninput="prev.src=this.value; prev.style.display='block'">
    <img id="prev" style="width:100%; height:180px; object-fit:cover; display:none; border-radius:15px; margin-top:15px; border: 2px solid var(--pink);">
    
    <button id="saveBtn">Publish to Shop</button>
    <button onclick="location.reload()" style="background:#888;">Logout</button>
</div>

<div class="main-content">
    <h2 style="color:var(--dark-pink)">Current Inventory</h2>
    <div id="admin-list">Loading items...</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyApoIe2nemnhB8unIDzoD5mnMSIMQv5pb0",
        authDomain: "zab-digital-prints.firebaseapp.com",
        projectId: "zab-digital-prints",
        storageBucket: "zab-digital-prints.firebasestorage.app",
        messagingSenderId: "1050157785592",
        appId: "1:1050157785592:web:e6a3c8f10a9d28aa87b60d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let editID = null;

    window.login = () => {
        if(document.getElementById('entryPass').value === "zab123") {
            document.getElementById('login-gate').style.display = "none";
            loadList();
        } else { alert("Wrong password"); }
    };

    document.getElementById('saveBtn').onclick = async () => {
        const data = {
            name: document.getElementById('pName').value,
            price: document.getElementById('pPrice').value,
            category: document.getElementById('pCat').value,
            status: document.getElementById('pStatus').value,
            imgUrl: document.getElementById('pImg').value
        };

        if(editID) {
            await updateDoc(doc(db, "products", editID), data);
            alert("Updated!");
        } else {
            await addDoc(collection(db, "products"), { ...data, createdAt: Date.now() });
            alert("Published!");
        }
        location.reload();
    };

    function loadList() {
        onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('admin-list');
            list.innerHTML = "";
            snap.forEach(d => {
                const item = d.data();
                const div = document.createElement('div');
                div.className = "inventory-card";
                div.innerHTML = `
                    <img src="${item.imgUrl}">
                    <div style="flex-grow:1">
                        <b>${item.name}</b><br>â‚±${item.price} | ${item.status || 'Available'}
                    </div>
                    <button onclick="editProduct('${d.id}', '${item.name}', '${item.price}', '${item.category}', '${item.status}', '${item.imgUrl}')" style="width:auto; background:#5cb85c;">Edit</button>
                    <button onclick="deleteProduct('${d.id}')" style="width:auto; background:#ff4d4d; margin-left:5px;">Del</button>
                `;
                list.appendChild(div);
            });
        });
    }

    window.editProduct = (id, n, p, c, s, i) => {
        editID = id;
        document.getElementById('pName').value = n;
        document.getElementById('pPrice').value = p;
        document.getElementById('pCat').value = c;
        document.getElementById('pStatus').value = s || "Available";
        document.getElementById('pImg').value = i;
        document.getElementById('saveBtn').innerText = "Update Now";
        document.getElementById('formHeader').innerText = "Edit Mode";
        window.scrollTo(0,0);
    };

    window.deleteProduct = async (id) => { if(confirm("Delete item?")) await deleteDoc(doc(db, "products", id)); };
</script>
</body>
</html>
